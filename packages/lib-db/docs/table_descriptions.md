
# SmartForms Database Tables Reference

This document provides a summary of each table in the **smartform** schema, along with its description and purpose. Use this as a reference for developers and future maintainers.

| S.No | Table Name                         | Description                                                                                     | Purpose                                                                                                                                                                                      |
|------|------------------------------------|-------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1    | `sf_users`                         | Stores user accounts for authentication and identity.                                          | Contains NextAuth user records (`id`, `contact`, `name`, etc.) used for login, profile, and tier information.                                                                                |
| 2    | `sf_sessions`                      | Tracks active user sessions.                                                                   | Maintains session tokens, expiry times, and user associations for NextAuth session management.                                                                                                |
| 3    | `sf_accounts`                      | OAuth provider account links for users.                                                        | Holds OAuth provider credentials and tokens (e.g., Google, GitHub) linked to `sf_users` for authentication.                                                                                   |
| 4    | `sf_verification_tokens`           | Stores email verification tokens.                                                              | Manages one-time tokens for email-based sign-in or passwordless flow in NextAuth.                                                                                                            |
| 5    | `sf_forms`                         | Contains high-level form metadata.                                                             | Stores form attributes (`id`, `user_id`, `title`, `data`, timestamps) used by the application to list and render forms.                                                                     |
| 6    | `sf_form_raw_data`                 | Stores raw JSON data and versions of forms.                                                    | Maintains form builder data for each version, including `status` (WIP or PUBLISH), `raw_json`, and a precomputed `thumbnail`.                                                               |
| 7    | `sf_org_accounts`                  | Represents tenant/organization accounts.                                                       | Defines billing, subscription, and organizational settings per tenant (billing address, currency, provider, plan, status, etc.).                                                             |
| 8    | `sf_user_orgs`                     | Join table linking users to organizations with a role.                                         | Maps `sf_users.id` to `sf_org_accounts.id`, assigning roles (`OWNER`, `ADMIN`, `DEVELOPER`, `VIEWER`) and activation status.                                                                  |
| 9    | `sf_invites`                       | Invitation records for adding users to organizations.                                          | Generates and tracks invitation tokens for new or pending users (`invited_email`) to join a specific organization with a requested `role_requested`.                                         |
| 10   | `sf_audit_logs`                    | Tenant-scoped activity history.                                                                | Logs major actions (`event_type`, `metadata`) performed by users within an organization (user invites, role changes, billing events, form actions) for compliance and troubleshooting.     |
| 11   | `sf_feature_flags`                 | Global feature toggle store.                                                                   | Manages flags (`flag_key`, `is_enabled`, `min_plan_required`) that enable or disable features across all organizations; can be extended per tenant in future phases.                          |
| 12   | `sf_distribution_groups`           | Email distribution groups defined by organization.                                             | Groups of recipient email addresses (`name`) belonging to a specific organization, used for follow-up email scheduling and notifications.                                                   |
| 13   | `sf_distribution_group_members`    | Member emails for each distribution group.                                                     | Lists individual email addresses belonging to a distribution group (`group_id`), enabling dynamic membership.                                                                                |
| 14   | `sf_form_views`                    | Tracks page views of published forms.                                                          | Records each form access (`form_id`, `viewed_at`, `visitor_id`, `ip_address`) for analytics and to calculate unique view counts used in follow-up logic.                                     |
| 15   | `sf_ownership_transfers`           | Pending or completed ownership transfer requests.                                              | Manages multi-step ownership handoff (`old_owner_id`, `new_owner_id`, `effective_at`, `status`) with confirmation workflow to ensure a safe transfer of the `OWNER` role within an org.     |
| 16   | `sf_invoices`                      | Stores current billing invoices.                                                               | Records invoice details (`provider`, `provider_invoice_id`, `amounts`, `currency`, `status`, `invoice_date`, `due_date`, `pdf_blob`) for each organizationâ€™s billing activities.            |
| 17   | `sf_invoices_archive`              | Archives older invoices for compliance and retention.                                           | Moves old invoice records from `sf_invoices` into a historical table, preserving `archived_at` and enabling long-term storage without cluttering the live `sf_invoices`.                      |
